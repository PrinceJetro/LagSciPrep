{% extends 'base.html' %}
{% block title %}{{ topic.name }} - LagSciPrep{% endblock %}
{% block og_title %}{{ topic.name }} - LagSciPrep{% endblock %}
{% block og_description %}Explore {{ topic.name }} topic with CBT practice questions on LagSciPrep{% endblock %}
{% block content %}
<div class="topic-detail-container">
    <!-- Topic Header -->
    <div class="topic-header mb-5">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'course_detail' topic.course.id %}">{{ topic.course.name }}</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ topic.name }}</li>
            </ol>
        </nav>
        
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-5 fw-bold text-primary mb-3">{{ topic.name }}</h1>
                {% if topic.description %}
                <p class="lead text-muted">{{ topic.description|safe }}</p>
                {% endif %}
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{% url 'start_topic_cbt' topic.id %}" class="btn btn-success btn-lg">
                    <i class="fas fa-play-circle me-2"></i>Practice CBT On This Topic
                </a>
            </div>
        </div>
    </div>

    <!-- Topic Material -->
    <div class="card card-custom mb-5">
        <div class="card-header card-header-custom">
            <h3 class="card-title mb-0"><i class="fas fa-file-alt me-2"></i> Topic Material</h3>
        </div>
        <div class="card-body">
            {% if embed_url %}
            <div class="responsive-embed">
                <iframe src="{{ embed_url }}" title="Topic document preview" loading="lazy" allowfullscreen="" aria-label="Topic document preview"></iframe>
            </div>
            {% elif topic.external_url %}
            <p>Preview unavailable. <a href="{{ topic.external_url }}" target="_blank" rel="noopener">Open document</a></p>
            {% else %}
            <p>No document available for this topic.</p>
            {% endif %}
            <p class="mt-2"><small class="text-muted">Ensure the document is shared publicly (Anyone with the link) for the preview to work.</small></p>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-4 mb-5 stats-grid">
        <div class="col-sm-6 col-md-4">
            <div class="card stat-card shadow-sm text-center p-3">
                <div class="stat-icon objective mx-auto mb-3">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-value">{{ obj_questions_count }}</div>
                <div class="stat-label text-muted small">Objective Questions</div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4">
            <div class="card stat-card shadow-sm text-center p-3">
                <div class="stat-icon theory mx-auto mb-3">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-value">{{ theory_questions_count|default:"—" }}</div>
                <div class="stat-label text-muted small">Theory Questions</div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4">
            <div class="card stat-card shadow-sm text-center p-3">
                <div class="stat-icon practice mx-auto mb-3">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="stat-value">{{ total_practices|default:"—" }}</div>
                <div class="stat-label text-muted small">Practice Sessions</div>
            </div>
        </div>
    </div>

    <!-- Questions Sections -->
    <div class="row">
        <!-- Objective Questions -->
        <div class="col-lg-12 mb-12">
            <div class="card card-custom h-100">
                <div class="card-header card-header-custom d-flex justify-content-between align-items-center">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-check-circle me-2"></i>
                        Objective Questions
                    </h3>
                    <span class="badge bg-success">{{ obj_questions_count }}</span>
                </div>
                <div class="card-body">
                    <div id="obj-questions-container">
                        <div class="text-center">
                            <a href="{% url 'topic_obj_questions' topic.id %}" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>View All Objective Questions
                            </a>
                        </div>
                    </div>
                </div>
                {% if obj_questions %}
                <div class="card-footer bg-transparent">
                    <a href="{% url 'start_topic_cbt' topic.id %}?type=objective" class="btn btn-success w-100">
                        <i class="fas fa-play me-2"></i>Practice Objective Questions
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- Practice Options -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card card-custom">
                <div class="card-header card-header-custom text-center">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-rocket me-2"></i>
                        Practice Options
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-6 mb-6">
                            <div class="practice-option-card">
                                <div class="practice-icon mixed">
                                    <i class="fas fa-random"></i>
                                </div>
                                <h5>Mixed Practice</h5>
                                <p class="text-muted small">Combine objective and theory questions</p>
                                <a href="{% url 'start_topic_cbt' topic.id %}" class="btn btn-primary w-100">
                                    Start Mixed CBT
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6 mb-6">
                            <div class="practice-option-card">
                                <div class="practice-icon objective-only">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <h5>Objective Only</h5>
                                <p class="text-muted small">Focus on multiple choice questions</p>
                                <a href="{% url 'start_topic_cbt' topic.id %}?type=objective" class="btn btn-success w-100">
                                    Objective Only
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="navigation-buttons mt-5">
        <div class="row">
            <div class="col-6">
                <a href="{% url 'course_detail' topic.course.id %}" class="btn btn-secondary btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>Back to Course
                </a>
            </div>
            <div class="col-6 text-end">
                <a href="{% url 'home' %}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-home me-2"></i>Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<style>
:root { --card-bg: #ffffff; --muted: #6b7280; --glass: rgba(255,255,255,0.85); }
.topic-detail-container { max-width: 1100px; margin: 0 auto; padding: 1rem; }
.topic-header { border-bottom: 1px solid rgba(15,23,42,0.04); padding-bottom: 1.5rem; }
.topic-header .display-5 { color: var(--primary-color, #4a6bff); }

.card-custom { border-radius: 12px; overflow: hidden; border: none; box-shadow: 0 8px 28px rgba(13, 18, 35, 0.06); }
.card-header-custom { background: linear-gradient(90deg, rgba(86,103,255,0.12), rgba(86,103,255,0.06)); border-bottom: none; padding: 0.9rem 1.25rem; }
.card-header-custom .card-title { font-weight: 600; }

/* Responsive embed */
.responsive-embed { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 10px; }
.responsive-embed iframe { position: absolute; top:0; left:0; width:100%; height:100%; border:0; }

/* Stats grid */
.stats-grid .stat-card { border-radius: 12px; background: var(--card-bg); }
.stat-icon { width:72px; height:72px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.4rem; color: #fff; margin: 0 auto 0.75rem; }
.stat-icon.objective { background: linear-gradient(135deg,#10b981,#059669); }
.stat-icon.theory { background: linear-gradient(135deg,#06b6d4,#0ea5e9); }
.stat-icon.practice { background: linear-gradient(135deg,#8b5cf6,#7c3aed); }
.stat-value { font-size:1.75rem; font-weight:700; color:#0f172a; }
.stat-label { color:var(--muted); font-size:0.875rem; }

/* Practice option cards */
.practice-option-card { padding: 1.25rem; border-radius: 12px; background: linear-gradient(180deg, rgba(255,255,255,1), rgba(248,250,252,1)); box-shadow: 0 8px 20px rgba(2,6,23,0.04); }
.practice-option-card h5 { margin-bottom: 0.5rem; }
.practice-option-card .btn { border-radius: 8px; }

/* Buttons */
.btn-cta { background: linear-gradient(90deg,#5b6ef8,#4b5be6); color: #fff; border-radius: 10px; padding: .45rem 1rem; }

/* Misc */
.question-item { transition: all 0.2s ease; }
.question-item:hover { transform: translateY(-2px); background: rgba(15,23,42,0.02); }

.navigation-buttons .btn { min-width: 180px; }

@media (max-width: 768px) {
    .topic-detail-container{ padding: 0.5rem; }
    .stat-value{ font-size:1.5rem; }
}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add animation to stat cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 200);
        });
        
        // Add click tracking for practice options
        const practiceButtons = document.querySelectorAll('.practice-option-card .btn');
        practiceButtons.forEach(button => {
            button.addEventListener('click', function() {
                const practiceType = this.textContent.trim();
                // You can add analytics tracking here
                console.log(`Starting ${practiceType} practice for topic: {{ topic.name }}`);
            });
        });
    });
</script>
{% endblock %}