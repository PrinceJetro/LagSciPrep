<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}LagSciPrep — Science CBT Practice Platform{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="https://suuzqweiijplovliqlfy.supabase.co/storage/v1/object/public/Education/diagrams/LagScipreplogo.png" type="image/x-icon">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}LagSciPrep — Master Science with CBT Practice{% endblock %}" />
    <meta property="og:description" content="{% block og_description %}Ace your science exams with our comprehensive Computer-Based Testing platform{% endblock %}" />
    <meta property="og:image" content="{% block og_image %}https://suuzqweiijplovliqlfy.supabase.co/storage/v1/object/public/Education/diagrams/LagScipreplogo.png{% endblock %}" />
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}" />
    <meta property="og:type" content="website" />
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- MathJax for rendering math expressions -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --primary-color: #4a6bff;
            --primary-dark: #3a56e0;
            --secondary-color: #6c757d;
            --accent-color: #ff6b6b;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #212529;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 12px;
            --border-radius-lg: 20px;
            
            /* Light mode colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #333333;
            --text-secondary: #6c757d;
            --border-color: rgba(0, 0, 0, 0.1);
            --navbar-bg: rgba(255, 255, 255, 0.95);
        }
        
        /* Dark mode colors */
        html.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #e8e8e8;
            --text-secondary: #b0b0b0;
            --border-color: rgba(255, 255, 255, 0.1);
            --navbar-bg: rgba(26, 26, 26, 0.95);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            line-height: 1.7;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition-smooth);
        }
        
        html.dark-mode body {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
        }
        
        /* Navbar Styles */
        .navbar-main {
            background: var(--navbar-bg);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition-smooth);
        }
        
        html.dark-mode .navbar-main {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .navbar-main.scrolled {
            padding: 0.8rem 0;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        }
        
        .brand-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Toggler and focus improvements */
        .navbar-toggler {
            border: none;
            padding: 0.35rem 0.5rem;
            transition: var(--transition-smooth);
        }

        .navbar-toggler:focus { outline: 3px solid rgba(74,107,255,0.12); outline-offset: 2px; }

        .navbar-toggler-icon {
            display: inline-block;
            width: 22px;
            height: 2px;
            background: currentColor;
            position: relative;
        }

        .navbar-toggler-icon::before,
        .navbar-toggler-icon::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: currentColor;
            transition: var(--transition-smooth);
        }

        .navbar-toggler-icon::before { top: -7px; }
        .navbar-toggler-icon::after { bottom: -7px; }

        .btn-close:focus { outline: 3px solid rgba(0,0,0,0.08); outline-offset: 2px; border-radius: 4px; }

        
        .brand-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
        }
        
        .brand-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-item-custom {
            margin: 0 0.5rem;
        }
        
        .nav-link-custom {
            color: var(--text-secondary) !important;
            font-weight: 500;
            padding: 0.75rem 1.25rem !important;
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-link-custom:hover {
            color: var(--primary-color) !important;
            background: rgba(74, 107, 255, 0.08);
            transform: translateY(-2px);
        }
        
        html.dark-mode .nav-link-custom:hover {
            background: rgba(74, 107, 255, 0.15);
        }
        
        .nav-link-custom.active {
            color: white !important;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            box-shadow: 0 4px 15px rgba(74, 107, 255, 0.3);
        }
        
        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
        }
        
        .user-profile:hover {
            background: rgba(0, 0, 0, 0.02);
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(74, 107, 255, 0.2);
            transition: var(--transition-smooth);
        }
        
        .user-avatar:hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .user-role {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 2rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(74, 107, 255, 0.1) 0%, transparent 70%);
            z-index: -1;
        }
        
        /* Alert Styling */
        .alert-custom {
            border-radius: var(--border-radius);
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 1.25rem 1.5rem;
            margin-bottom: 2rem;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Footer Styles */
        .footer-main {
            background: linear-gradient(135deg, var(--dark-bg), #1a1d23);
            color: white;
            padding: 4rem 0 2rem;
            margin-top: auto;
        }
        
        .footer-section {
            margin-bottom: 2rem;
        }
        
        .footer-heading {
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            position: relative;
            padding-bottom: 0.75rem;
            margin: auto;
        }
        
        .footer-heading::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 2px;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 0.8rem;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .footer-links a:hover {
            color: white;
            transform: translateX(5px);
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: var(--transition-smooth);
        }
        
        .social-icon:hover {
            background: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .copyright {
            padding-top: 2rem;
            margin-top: 3rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        /* Utility Classes */
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: var(--transition-smooth);
            box-shadow: 0 4px 15px rgba(74, 107, 255, 0.3);
        }
        
        .btn-primary-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 107, 255, 0.4);
            color: white;
        }
        
        .btn-logout {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: var(--transition-smooth);
        }
        
        .btn-logout:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            color: white;
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            background: none;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-size: 1.2rem;
        }
        
        .theme-toggle:hover {
            background: rgba(74, 107, 255, 0.1);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
        
        .theme-toggle:active {
            transform: scale(0.95);
        }
        
        .theme-icon {
            transition: var(--transition-smooth);
        }
        
        .theme-toggle .sun-icon {
            display: none;
        }
        
        html.dark-mode .theme-toggle .sun-icon {
            display: inline;
        }
        
        html.dark-mode .theme-toggle .moon-icon {
            display: none;
        }
        
        /* Small utilities */
        .muted-opacity { opacity: 0.85; }
        .muted-opacity-icon { opacity: 0.8; }
        
        /* General dark mode text colors */
        html.dark-mode {
            color-scheme: dark;
        }
        
        html.dark-mode input,
        html.dark-mode textarea,
        html.dark-mode select {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        html.dark-mode .card {
            background-color: var(--bg-secondary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        html.dark-mode .table {
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        html.dark-mode .table thead th {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        html.dark-mode .form-control,
        html.dark-mode .form-select {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        html.dark-mode .form-control:focus,
        html.dark-mode .form-select:focus {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(74, 107, 255, 0.25);
        }
        
        html.dark-mode .navbar-collapse {
            background: var(--bg-secondary);
        }
        
        html.dark-mode .glass-effect {
            background: rgba(45, 45, 45, 0.9);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        html.dark-mode .alert {
            background-color: var(--bg-secondary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        html.dark-mode .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        html.dark-mode .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .navbar-collapse {
                background: white;
                border-radius: var(--border-radius);
                padding: 1.5rem;
                margin-top: 1rem;
                box-shadow: var(--card-shadow);
            }
            
            .brand-text {
                font-size: 1.4rem;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1.5rem 0;
            }
            
            .footer-main {
                padding: 3rem 0 1.5rem;
            }
        }
        
        @media (max-width: 576px) {
            .brand-text {
                display: none;
            }
            
            .user-details {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-main">
        <div class="container">
            <div class="brand-wrapper">
                <img src="https://suuzqweiijplovliqlfy.supabase.co/storage/v1/object/public/Education/diagrams/LagScipreplogo.png" 
                     alt="LagSciPrep Logo" 
                     class="brand-logo">
                <span class="brand-text">LagSciPrep</span>
            </div>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarMain">
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                    <li class="nav-item nav-item-custom">
                        <a class="nav-link nav-link-custom {% if request.resolver_match.url_name == 'home' %}active{% endif %}" 
                           href="{% url 'home' %}">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item nav-item-custom">
                        <a class="nav-link nav-link-custom {% if request.resolver_match.url_name == 'progress' %}active{% endif %}" 
                           href="{% url 'progress' %}">
                            <i class="fas fa-chart-line"></i>
                            <span>Progress</span>
                        </a>
                    </li>
                    <li class="nav-item nav-item-custom">
                        <a class="nav-link nav-link-custom {% if request.resolver_match.url_name == 'student_list' %}active{% endif %}" 
                           href="{% url 'student_list' %}">
                            <i class="fas fa-users"></i>
                            <span>Students</span>
                        </a>
                    </li>
                </ul>
                
                <!-- Search Form -->
                <form class="d-flex me-3" action="{% url 'search' %}" method="get">
                    <input class="form-control me-2" type="search" name="q" placeholder="Search topics, questions..." aria-label="Search" value="{{ request.GET.q }}">
                    <button class="btn btn-outline-primary" type="submit" aria-label="Search">
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <span class="visually-hidden">Search</span>
                    </button>
                </form>
                
                <!-- Theme Toggle Button -->
                <button class="theme-toggle me-3" id="themeToggle" type="button" aria-label="Toggle theme" title="Toggle dark/light mode">
                    <i class="fas fa-moon theme-icon moon-icon"></i>
                    <i class="fas fa-sun theme-icon sun-icon"></i>
                </button>
                
                <div class="user-profile">
                    {% if user.is_authenticated %}
                        <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=4a6bff&color=fff&bold=true&size=128" 
                             alt="User Avatar" 
                             class="user-avatar">
                        <div class="user-details d-none d-md-block">
                            <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                            <div class="user-role">Student</div>
                        </div>
                        <form action="{% url 'logout' %}" method="post" class="ms-2">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-logout">
                                <i class="fas fa-sign-out-alt"></i>
                                <span class="d-none d-md-inline">Logout</span>
                            </button>
                        </form>
                    {% else %}
                        <a href="{% url 'login' %}" class="btn btn-primary-custom">
                            <i class="fas fa-sign-in-alt"></i>
                            <span>Login</span>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Messages -->
            {% if messages %}
                <div class="row">
                    <div class="col-12">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-custom d-flex align-items-center" role="alert">
                                <i class="fas 
                                    {% if message.tags == 'success' %}fa-check-circle
                                    {% elif message.tags == 'error' %}fa-exclamation-circle
                                    {% elif message.tags == 'warning' %}fa-exclamation-triangle
                                    {% else %}fa-info-circle{% endif %}
                                    me-3 fs-4"></i>
                                <div class="flex-grow-1">
                                    {{ message }}
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            
            <!-- Page Content -->
            {% block content %}
            <!-- Page-specific content will go here -->
            {% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-main">
        <div class="container">
            <div class="row">
                <!-- About Section -->
                <div class="col-lg-12 col-md-6 footer-section">
                    <h4 class="footer-heading">About LagSciPrep</h4>
                    <p class="text-light mb-3 muted-opacity">
                        A cutting-edge Computer-Based Testing platform designed by the  <b>2025/2026 Cell Biology and Genetics Students of the University of Lagos</b> under the supervision of The Course Advisor <i>Dr Olasan Olalekan</i> to help students excel in science subjects through interactive practice and real-time feedback.
                    </p>
                    <p class="text-light mb-3 muted-opacity">
                        <b>Disclaimer</b>: All lecture slides and instructional materials provided on this platform are original resources shared by the course lecturers for learning purposes. Ownership of these materials remains with the respective lecturers and the University of Lagos.                   
                     </p>
                    <p class="text-light mb-3 muted-opacity">
                        The unique contribution of this platform lies in its practice system, question bank, and interactive testing portal designed to enhance understanding and exam preparedness.
                    </p>
                    <div class="social-links">
                        <a href="#" class="social-icon" aria-label="Twitter" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="Facebook" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="Instagram" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="LinkedIn" title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>
                           
               
            </div>
            
            <!-- Copyright -->
            <div class="row">
                <div class="col-12">
                    <div class="copyright">
                        <p class="mb-0">
                            &copy; <span id="currentYear"></span> LagSciPrep — Science CBT Practice Platform. All rights reserved.
                        </p>
                        <p class="mt-2 mb-0">
                            Designed with <i class="fas fa-heart text-danger muted-opacity-icon" aria-hidden="true"></i> for students worldwide
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Dark Mode Toggle Functionality
        (function() {
            const htmlElement = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            const STORAGE_KEY = 'lagSciPrep-theme-preference';
            
            // Check for saved theme preference or default to light mode
            function initTheme() {
                const savedTheme = localStorage.getItem(STORAGE_KEY);
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                let isDarkMode = false;
                if (savedTheme !== null) {
                    isDarkMode = savedTheme === 'dark';
                } else {
                    isDarkMode = prefersDark;
                }
                
                applyTheme(isDarkMode);
            }
            
            // Apply theme to document
            function applyTheme(isDarkMode) {
                if (isDarkMode) {
                    htmlElement.classList.add('dark-mode');
                    localStorage.setItem(STORAGE_KEY, 'dark');
                } else {
                    htmlElement.classList.remove('dark-mode');
                    localStorage.setItem(STORAGE_KEY, 'light');
                }
            }
            
            // Toggle theme on button click
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const isDarkMode = htmlElement.classList.contains('dark-mode');
                    applyTheme(!isDarkMode);
                });
            }
            
            // Initialize theme on page load
            initTheme();
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (localStorage.getItem(STORAGE_KEY) === null) {
                    applyTheme(e.matches);
                }
            });
        })();
        
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar-main');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });
        
        // Smooth scroll to top on page load
        window.addEventListener('load', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert-custom');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.classList.add('fade');
                    setTimeout(() => alert.remove(), 300);
                }, 5000);
            });
        });

        // Manage focus for Bootstrap modals to avoid aria-hidden-focus warnings
        document.addEventListener('shown.bs.modal', function(e) {
            try {
                e.target.__previouslyFocused = document.activeElement;
                const closeBtn = e.target.querySelector('.btn-close');
                if (closeBtn && typeof closeBtn.focus === 'function') closeBtn.focus();
            } catch (err) { /* ignore */ }
        });
        document.addEventListener('hidden.bs.modal', function(e) {
            try {
                const prev = e.target.__previouslyFocused;
                if (prev && typeof prev.focus === 'function') prev.focus();
                // cleanup leftover backdrops too
                document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
                document.body.classList.remove('modal-open');
            } catch (err) { /* ignore */ }
        });
    </script>
</body>
</html>