{% extends 'base.html' %}
{% block title %}{{ course.name }} - LagSciPrep{% endblock %}
{% block og_title %}{{ course.name }} - LagSciPrep{% endblock %}
{% block og_description %}Learn about {{ course.name }} course on LagSciPrep with CBT practice questions{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <!-- Hero Header -->
    <div class="course-hero bg-gradient-primary text-white py-5 mb-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <nav aria-label="breadcrumb" class="mb-3">
                        <ol class="breadcrumb breadcrumb-light">
                            <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white-50">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'course_list' %}" class="text-white-50">Courses</a></li>
                            <li class="breadcrumb-item active text-white" aria-current="page">{{ course.name }}</li>
                        </ol>
                    </nav>
                    <h1 class="display-4 fw-bold mb-3">{{ course.name }}</h1>
                    {% if course.code %}
                    <p class="lead mb-4 opacity-75">Course Code: {{ course.code }}</p>
                    {% endif %}
                    <div class="d-flex flex-wrap gap-3 align-items-center">
                        <a href="{% url 'start_cbt' course.id %}" class="btn btn-light btn-lg px-4 py-3 fw-bold shadow-sm">
                            <i class="fas fa-play-circle me-2"></i>Start CBT Practice
                        </a>
                        <div class="text-white-75">
                            <i class="fas fa-book me-1"></i>
                            <span class="fw-medium">{{ topics.count }} topics</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 d-none d-lg-block text-end">
                    <div class="hero-icon">
                        <i class="fas fa-graduation-cap fa-8x opacity-25"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages -->
    <div class="container mb-5">
        {% for message in messages %}
        <div class="alert alert-info alert-dismissible fade show d-flex align-items-center shadow-sm" role="alert">
            <i class="fas fa-info-circle fa-lg me-3"></i>
            <div class="flex-grow-1">{{ message }}</div>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>

    <div class="container">
        <div class="row g-4">
            <!-- Topics Card -->
            <div class="col-lg-4">
                <div class="card border-0 shadow-lg h-100">
                    <div class="card-header bg-white border-0 py-4">
                        <div class="d-flex align-items-center">
                            <div class="icon-wrapper bg-primary bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="fas fa-folder-open text-primary fa-lg"></i>
                            </div>
                            <div>
                                <h2 class="h5 fw-bold mb-1">Course Topics</h2>
                                <span class="badge bg-primary bg-opacity-10 text-primary">{{ topics.count }} topics</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        {% if topics %}
                        <div class="list-group list-group-flush">
                            {% for topic in topics %}
                            <a href="{% url 'topic_detail' topic.id %}" 
                               class="list-group-item list-group-item-action border-0 py-3 px-4 hover-lift">
                                <div class="d-flex align-items-start">
                                    <div class="topic-icon me-3 mt-1">
                                        <i class="fas fa-bookmark text-warning"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="fw-bold mb-1">{{ topic.name }}</h6>
                                        {% if topic.description %}
                                        <p class="text-muted small mb-0 line-clamp-2">{{ topic.description }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="ms-2">
                                        <i class="fas fa-chevron-right text-muted"></i>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-5">
                            <div class="empty-state-icon mb-3">
                                <i class="fas fa-folder-open fa-3x text-muted opacity-50"></i>
                            </div>
                            <h5 class="text-muted mb-2">No Topics Yet</h5>
                            <p class="text-muted small">Topics will be added soon</p>
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-footer bg-white border-0 py-3">
                        <button type="button" class="btn btn-outline-primary w-100 btn-suggest-topic" aria-label="Suggest a topic">
                            <i class="fas fa-plus me-2" aria-hidden="true"></i>Suggest a Topic
                        </button>
                    </div>
                </div>
            </div>

            <!-- Questions Section -->
            <div class="col-lg-8">
                <!-- Objective Questions Card -->
                <div class="card border-0 shadow-lg mb-4">
                    <div class="card-header bg-white border-0 py-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <div class="icon-wrapper bg-success bg-opacity-10 p-3 rounded-circle me-3">
                                    <i class="fas fa-check-circle text-success fa-lg"></i>
                                </div>
                                <div>
                                    <h2 class="h5 fw-bold mb-1">Objective Questions</h2>
                                    <div class="text-muted small">Practice with multiple choice questions</div>
                                </div>
                            </div>
                            <span class="badge bg-success fs-6 px-3 py-2">{{ obj_questions_count }} questions</span>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <p class="mb-0">Test your knowledge with our curated objective questions. Perfect for exam preparation.</p>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <a href="{% url 'course_obj_questions' course.id %}" 
                                   class="btn btn-primary px-4 py-2 d-inline-flex align-items-center">
                                    <i class="fas fa-list me-2"></i>
                                    View All Questions
                                </a>
                            </div>
                        </div>
                        
                        <!-- Question Statistics -->
                        <div class="row mt-4 g-3">
                            <div class="col-md-4">
                                <div class="stat-card p-3 border rounded text-center">
                                    <div class="text-primary fw-bold fs-4 mb-1">{{ obj_questions_count }}</div>
                                    <div class="text-muted small">Total Questions</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-card p-3 border rounded text-center">
                                    <div class="text-success fw-bold fs-4 mb-1">100%</div>
                                    <div class="text-muted small">Comprehensive Coverage</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="stat-card p-3 border rounded text-center">
                                    <div class="text-warning fw-bold fs-4 mb-1">24/7</div>
                                    <div class="text-muted small">Available</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm h-100 bg-primary bg-opacity-5">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="icon-wrapper bg-primary p-3 rounded-circle me-3">
                                        <i class="fas fa-bolt text-white"></i>
                                    </div>
                                    <div>
                                        <h3 class="h5 fw-bold mb-2">Quick Start</h3>
                                        <p class="text-muted small">Jump into practice immediately</p>
                                    </div>
                                </div>
                                <a href="{% url 'start_cbt' course.id %}" 
                                   class="btn btn-warning w-100 py-3 fw-bold">
                                    <i class="fas fa-play-circle me-2"></i>
                                    Start Random Quiz
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm h-100 bg-warning bg-opacity-5">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="icon-wrapper bg-warning p-3 rounded-circle me-3">
                                        <i class="fas fa-chart-line text-white"></i>
                                    </div>
                                    <div>
                                        <h3 class="h5 fw-bold mb-2">Progress</h3>
                                        <p class="text-muted small">Track your learning journey</p>
                                    </div>
                                </div>
                                <a href="{% url 'progress' %}" class="btn btn-primary w-100 py-3 fw-bold">
                                    <i class="fas fa-chart-bar me-2"></i>
                                    View Progress
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --light-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    .course-hero {
        background: var(--primary-gradient);
        position: relative;
        overflow: hidden;
    }
    
    .course-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.1)" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
        background-size: cover;
    }
    
    .breadcrumb-light .breadcrumb-item a {
        color: rgba(255, 255, 255, 0.8) !important;
        transition: color 0.2s;
    }
    
    .breadcrumb-light .breadcrumb-item a:hover {
        color: white !important;
    }
    
    .hero-icon {
        animation: float 3s ease-in-out infinite;
    }
    
    .icon-wrapper {
        transition: transform 0.3s ease;
    }
    
    .hover-lift:hover .icon-wrapper {
        transform: translateY(-2px);
    }
    
    .list-group-item:hover {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4eaf5 100%);
        transform: translateX(5px);
        transition: all 0.3s ease;
    }
    
    .stat-card {
        transition: all 0.3s ease;
        border: 1px solid rgba(0,0,0,0.05) !important;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .btn-light {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    
    .btn-light:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    .empty-state-icon {
        opacity: 0.3;
    }
    
    @keyframes float {
        0%, 100% {
            transform: translateY(0px);
        }
        50% {
            transform: translateY(-10px);
        }
    }
    
    @media (max-width: 768px) {
        .course-hero {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .display-4 {
            font-size: 2.5rem;
        }
        
        .d-flex.flex-wrap {
            justify-content: center;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const suggestBtn = document.querySelector('.btn-suggest-topic');
        if (!suggestBtn) return;

        suggestBtn.addEventListener('click', function (e) {
            e.preventDefault();

            // Build alert HTML
            const alertHtml = `\
                <div class="alert alert-info alert-dismissible fade show suggest-alert" role="alert" aria-live="polite">\
                    <div><strong>Suggestion:</strong> Please send a WhatsApp message to <a href="https://wa.me/2348088981691" target="_blank" rel="noopener">+234 808 898 1691</a> with the topic you'd like added.</div>\
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\
                </div>`;

            // insert into the messages container if present, otherwise top of main container
            const msgContainer = document.querySelector('.container.mb-5');
            if (msgContainer) {
                msgContainer.insertAdjacentHTML('beforeend', alertHtml);
                const newAlert = msgContainer.querySelector('.suggest-alert');
                if (newAlert) newAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                const main = document.querySelector('.container');
                if (main) {
                    main.insertAdjacentHTML('afterbegin', alertHtml);
                    const newAlert = main.querySelector('.suggest-alert');
                    if (newAlert) newAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
    });
</script>

{% endblock %}